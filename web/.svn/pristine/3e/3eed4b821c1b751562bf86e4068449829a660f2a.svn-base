<script>
    // @ts-nocheck
    import { onMount } from "svelte";
    import { fetchBoardData } from "$lib/api/board";
    import { selectedCetegorySeq } from "$lib/stores/menu";
    import { env } from "$env/dynamic/public";

    const IMG_HOST = env.PUBLIC_IMG_HOST;

    let data = [];
    let list = [];
    let category = 99; // categorySeq 값

    let navigatepageNums = [];
    let pageSize = 9;
    let pageNum = 0;

    selectedCetegorySeq.subscribe((value) => {
        category = value;
    });

    $: if (category) {
        page_(1);
    }

    onMount(async () => {
        page_(1);
    });

    async function page_(idx) {
        pageNum = idx;
        let pageval = { pageSize, pageNum };
        data = await fetchBoardData(pageval);
        list = data.list;
        navigatepageNums = data.navigatepageNums;

        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
</script>
<!-- 메인 컨텐츠 -->
<div class="at-body">
    <div class="at-container">
      <div class="at-content">
        <section class="board-list">
          <div class="list-wrap">
            <form method="post" class="form">
              <div class="list-container">
                {#each list as row, i}
                <div class="list-row {row.category === 19 ? 'close_event' : ''}">
                  <div class="list-item">
                    <a
                      href={'/event/view/'+row.seq}
                      class="ellipsis"
                      title="{row.subject} 바로가기"
                    >
                      <div class="imgframe">
                        <img
                          src={IMG_HOST + row.filepath}
                          alt={row.subject}
                        />
                      </div>
                      <div class="list-content">
                        <p class="list-subject">{row.subject}</p>
                        <div class="list-txt hidden">
                            {row.content}
                        </div>
                      </div>
                    </a>
                  </div>
                </div>
                {/each}
              </div>
            </form>
          </div>
        </section>
      </div>
    </div>
{#if list.length > 0}
    <nav class="noselect">
        <ul class="pagination justify-content-center">
            <li class="page-item {data.hasPreviousPage ? '' : 'disabled'}">
                <a
                    class="page-link"
                    on:click={() => page_(data.prePage)}
                    aria-label="Previous"
                >
                    <span aria-hidden="true">이전</span>
                </a>
            </li>
            {#each navigatepageNums as pn}
                <li class="page-item {pn == data.pageNum ? 'active' : ''}">
                    <a class="page-link" on:click={() => page_(pn)}>{pn}</a>
                </li>
            {/each}
            <li class="page-item {data.hasNextPage ? '' : 'disabled'}">
                <a
                    class="page-link"
                    on:click={() => page_(data.nextPage)}
                    aria-label="Next"
                >
                    <span aria-hidden="true">다음</span>
                </a>
            </li>
        </ul>
    </nav>
{/if}
    <!-- Footer 네비게이션 -->
    <div id="footerGnb">
      <div class="img_box">
        <ul>
          <li>
            <a href="/event/all" title="이벤트 바로가기">
              <div class="thumb_img">
                <img src="/img/common/bottom_navi_img1.jpg" alt="이벤트" />
              </div>
              <div class="txt_elm">
                <strong>이벤트</strong>
                <p>대만을 120% 즐길 수 있는 <br /> 다양한 이벤트</p>
              </div>
              <div class="over_txt">
                <img
                  src="/img/common/botton_navi_over_img1.jpg"
                  alt="당첨 도전하기"
                />
                <span>당첨 도전하기</span>
              </div>
            </a>
          </li>
          <li>
            <a
              href="/introduction/tourism_board"
              title="대만 관광청 소개 바로가기"
            >
              <div class="thumb_img">
                <img
                  src="/img/common/bottom_navi_img2.jpg"
                  alt="대만 관광청 소개"
                />
              </div>
              <div class="txt_elm">
                <strong>대만 관광청 소개</strong>
                <p>대만 관광청에 대한 <br /> 모든 것</p>
              </div>
              <div class="over_txt">
                <img
                  src="/img/common/botton_navi_over_img2.jpg"
                  alt="관광청의 A to Z"
                />
                <span>관광청의 A to Z</span>
              </div>
            </a>
          </li>
          <li>
            <a href="/themeTour/recreation" title="테마 여행 바로가기">
              <div class="thumb_img">
                <img src="/img/common/bottom_navi_img3.jpg" alt="테마 여행" />
              </div>
              <div class="txt_elm">
                <strong>테마 여행</strong>
                <p>당신이 즐길 수 있는 <br /> 대만의 모든 테마 여행</p>
              </div>
              <div class="over_txt">
                <img
                  src="/img/common/botton_navi_over_img3.jpg"
                  alt="나와 맞는 여행찾기"
                />
                <span>나와 맞는 여행찾기</span>
              </div>
            </a>
          </li>
          <li>
            <a href="/attractions/all" title="대만명소 바로가기">
              <div class="thumb_img">
                <img src="/img/common/bottom_navi_img4.jpg" alt="대만 명소" />
              </div>
              <div class="txt_elm">
                <strong>대만 명소</strong>
                <p>지금 대만에서 가장 핫한 <br /> 지역별 다양한 명소</p>
              </div>
              <div class="over_txt">
                <img
                  src="/img/common/botton_navi_over_img4.jpg"
                  alt="여긴 꼭 가야해!"
                />
                <span>여긴 꼭 가야해!</span>
              </div>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <!-- //Footer 네비게이션 -->
  </div>
  
  <!-- //메인 컨텐츠 -->
  
  <style lang="scss">
    @import "/src/styles/variables.scss";
    .at-body {
      .at-container {
        margin: 0 auto;
      }
    }
  
    .list-container {
      &:after {
        content: "";
        display: block;
        clear: both;
      }
      .list-row {
        float: left;
        width: 30%;
        margin: 0 0 5% 5%;
        &:nth-of-type(3n + 1) {
          margin: 0 0 5%;
        }
        .imgframe {
          a {
            width: 100%;
            height: 100%;
            display: block;
          }
          img {
            width: 100%;
            display: block;
          }
        }
        &.close_event {
          .list-item {
            position: relative;
            &:after {
              width: 100%;
              height: 100%;
              content: "";
              display: block;
              position: absolute;
              top: 0;
              left: 0;
              background-color: rgba(0, 0, 0, 0.6);
            }
          }
        }
      }
    }
  
    @include desktop {
     .list-container {
        .list-row {
          width: 46.74479166666667%;
          margin: 0 0 5vw 6.510416%;
          &:nth-of-type(3n + 1) {
            margin: 0 0 5vw 6.51041%;
          }
          &:nth-of-type(2n + 1) {
            margin: 0 0 5vw;
          }
        }
      }
    }
  
    @include mobile {
     .list-container {
        .list-row {
          width: 100%;
          margin: 0 0 5vw;
          &:nth-of-type(3n + 1) {
            margin: 0 0 5vw;
          }
          &:nth-of-type(2n + 1) {
            margin: 0 0 5vw;
          }
        }
      }
    }
  </style>
  